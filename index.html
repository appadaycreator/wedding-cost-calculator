<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ウェディング費用計算機</title>
    <meta name="description" content="結婚式の費用を簡単に計算できるツールです。">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="theme-color" content="#ffffff">
    <meta property="og:title" content="ウェディング費用計算機">
    <meta property="og:description" content="結婚式の費用を簡単に計算できるツールです。">
    <meta property="og:image" content="https://appadaycreator.github.io/wedding-cost-calculator/images/ogp-image.jpg">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://appadaycreator.github.io/wedding-cost-calculator/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ウェディング費用計算機">
    <meta name="twitter:description" content="結婚式の費用を簡単に計算できるツールです。">
    <meta name="twitter:image" content="https://appadaycreator.github.io/wedding-cost-calculator/images/ogp-image.jpg">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TXQGZRF9');</script>
    <!-- End Google Tag Manager -->
    
    <!-- External Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Klee+One:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- PWA設定 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#F8E8E8">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE2IDJMMjAgMTBIMjhMMjIgMTZMMjQgMjRMMTYgMjBMOCAyNEwxMCAxNkw0IDEwSDEyTDE2IDJaIiBmaWxsPSIjRjhFOEU4Ii8+Cjwvc3ZnPgo=">
    
    <style>
        :root {
            --sakura-pink: #F8E8E8;
            --cream: #FFF8DC;
            --pearl-white: #FFFFFF;
            --soft-pink: #FFE4E6;
            --rose-gold: #E8B4B8;
            --gentle-gray: #F7FAFC;
            --text-dark: #2D3748;
            --text-soft: #718096;
        }
        
        body {
            font-family: 'Klee One', 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, var(--sakura-pink) 50%, var(--soft-pink) 100%);
            min-height: 100vh;
        }
        
        .klee-font {
            font-family: 'Klee One', cursive;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(248, 232, 232, 0.3);
        }
        
        .floating-hearts {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        
        .heart {
            position: absolute;
            color: var(--rose-gold);
            opacity: 0.3;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--rose-gold), #F8E8E8);
            color: var(--text-dark);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(248, 232, 232, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(248, 232, 232, 0.6);
        }
        
        .form-input {
            border: 2px solid var(--sakura-pink);
            border-radius: 15px;
            padding: 12px 16px;
            background: var(--pearl-white);
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            border-color: var(--rose-gold);
            box-shadow: 0 0 0 3px rgba(248, 232, 232, 0.3);
            outline: none;
        }
        
        .cost-item {
            background: var(--pearl-white);
            border-left: 4px solid var(--rose-gold);
            padding: 16px;
            margin: 8px 0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .cost-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(248, 232, 232, 0.3);
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        
        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--sakura-pink);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            color: var(--text-dark);
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .step.active {
            background: var(--rose-gold);
            color: white;
            transform: scale(1.1);
        }
        
        .step.completed {
            background: #48BB78;
            color: white;
        }
        
        .venue-card {
            background: var(--pearl-white);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .venue-card:hover {
            border-color: var(--rose-gold);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(248, 232, 232, 0.4);
        }
        
        .venue-card.selected {
            border-color: var(--rose-gold);
            background: var(--soft-pink);
        }
        
        .result-section {
            background: linear-gradient(135deg, var(--pearl-white) 0%, var(--soft-pink) 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(248, 232, 232, 0.3);
        }
        
        .savings-tip {
            background: var(--gentle-gray);
            border-left: 4px solid #48BB78;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background: var(--pearl-white);
            margin: 50px auto;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .social-share {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .social-btn {
            padding: 10px 15px;
            border-radius: 25px;
            text-decoration: none;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .twitter { background: #1DA1F2; }
        .facebook { background: #4267B2; }
        .line { background: #00B900; }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--sakura-pink);
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--rose-gold), #48BB78);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .modal-content {
                margin: 20px;
                padding: 20px;
            }
            
            .venue-card {
                padding: 15px;
                margin: 10px 0;
            }
            
            .glass-card {
                margin: 10px;
                padding: 20px;
            }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tooltip {
            position: relative;
            cursor: help;
        }
        
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-dark);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TXQGZRF9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div class="floating-hearts">
        <i class="fas fa-heart heart" style="left: 10%; animation-delay: 0s; font-size: 20px;"></i>
        <i class="fas fa-heart heart" style="left: 20%; animation-delay: 1s; font-size: 16px;"></i>
        <i class="fas fa-heart heart" style="left: 30%; animation-delay: 2s; font-size: 24px;"></i>
        <i class="fas fa-heart heart" style="left: 40%; animation-delay: 3s; font-size: 18px;"></i>
        <i class="fas fa-heart heart" style="left: 50%; animation-delay: 4s; font-size: 22px;"></i>
        <i class="fas fa-heart heart" style="left: 60%; animation-delay: 5s; font-size: 16px;"></i>
        <i class="fas fa-heart heart" style="left: 70%; animation-delay: 1.5s; font-size: 20px;"></i>
        <i class="fas fa-heart heart" style="left: 80%; animation-delay: 2.5s; font-size: 18px;"></i>
        <i class="fas fa-heart heart" style="left: 90%; animation-delay: 3.5s; font-size: 24px;"></i>
    </div>

    <!-- ヘッダー -->
    <header class="glass-card mx-4 mt-4 rounded-xl p-6">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <i class="fas fa-rings-wedding text-3xl mr-3" style="color: var(--rose-gold);"></i>
                <h1 class="klee-font text-2xl font-bold" style="color: var(--text-dark);">
                    結婚式費用計算機
                </h1>
            </div>
            <nav class="hidden md:flex space-x-6">
                <a href="#calculator" class="text-gray-600 hover:text-pink-400 transition-colors">計算機</a>
                <a href="#tips" class="text-gray-600 hover:text-pink-400 transition-colors">節約のコツ</a>
                <a href="#contact" class="text-gray-600 hover:text-pink-400 transition-colors">お問い合わせ</a>
            </nav>
        </div>
    </header>

    <!-- メインコンテンツ -->
    <main class="container mx-auto px-4 py-8">
        <!-- ヒーローセクション -->
        <section class="text-center mb-12 animate-fade-in">
            <div class="glass-card rounded-2xl p-8 mb-8">
                <h2 class="klee-font text-4xl font-bold mb-4" style="color: var(--text-dark);">
                    <i class="fas fa-sparkles mr-2" style="color: var(--rose-gold);"></i>
                    あなたの理想の結婚式を叶えるために
                    <i class="fas fa-sparkles ml-2" style="color: var(--rose-gold);"></i>
                </h2>
                <p class="text-lg mb-6" style="color: var(--text-soft);">
                    結婚式の費用って、最初はなかなか分からないものですよね。<br>
                    でも大丈夫！一緒に理想の結婚式の費用を計算してみましょう💕
                </p>
                <div class="flex justify-center items-center space-x-8 mb-6">
                    <div class="text-center">
                        <i class="fas fa-heart text-2xl mb-2" style="color: var(--rose-gold);"></i>
                        <p class="text-sm">簡単入力</p>
                    </div>
                    <div class="text-center">
                        <i class="fas fa-calculator text-2xl mb-2" style="color: var(--rose-gold);"></i>
                        <p class="text-sm">詳細見積もり</p>
                    </div>
                    <div class="text-center">
                        <i class="fas fa-lightbulb text-2xl mb-2" style="color: var(--rose-gold);"></i>
                        <p class="text-sm">節約のコツ</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 計算機セクション -->
        <section id="calculator" class="mb-12">
            <div class="glass-card rounded-2xl p-8">
                <!-- プログレスバー -->
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
                
                <!-- ステップインジケーター -->
                <div class="step-indicator">
                    <div class="step active" id="step1">1</div>
                    <div class="step" id="step2">2</div>
                    <div class="step" id="step3">3</div>
                    <div class="step" id="step4">4</div>
                </div>

                <!-- ステップ1: 基本情報 -->
                <div id="section1" class="step-section animate-fade-in">
                    <h3 class="klee-font text-2xl font-bold mb-6 text-center" style="color: var(--text-dark);">
                        <i class="fas fa-users mr-2" style="color: var(--rose-gold);"></i>
                        まずは基本情報を教えてくださいね
                    </h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: var(--text-dark);">
                                ゲスト数 <span class="tooltip" data-tooltip="挙式・披露宴に参加される方の総数です">💡</span>
                            </label>
                            <input type="number" id="guestCount" class="form-input w-full" placeholder="例: 70" min="1" max="500">
                            <p class="text-xs mt-1" style="color: var(--text-soft);">一般的には50-80名程度です</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: var(--text-dark);">
                                地域 <span class="tooltip" data-tooltip="会場のある都道府県を選択してください">💡</span>
                            </label>
                            <select id="region" class="form-input w-full">
                                <option value="">地域を選択してください</option>
                                <option value="tokyo">東京都</option>
                                <option value="osaka">大阪府</option>
                                <option value="kyoto">京都府</option>
                                <option value="yokohama">神奈川県</option>
                                <option value="nagoya">愛知県</option>
                                <option value="fukuoka">福岡県</option>
                                <option value="other">その他の地域</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="text-center mt-8">
                        <button onclick="nextStep()" class="btn-primary">
                            次へ <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- ステップ2: 会場選択 -->
                <div id="section2" class="step-section hidden">
                    <h3 class="klee-font text-2xl font-bold mb-6 text-center" style="color: var(--text-dark);">
                        <i class="fas fa-church mr-2" style="color: var(--rose-gold);"></i>
                        どんな会場がお好みですか？
                    </h3>
                    
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="venue-card" onclick="selectVenue('hotel')">
                            <i class="fas fa-building text-3xl mb-3" style="color: var(--rose-gold);"></i>
                            <h4 class="font-bold mb-2">ホテル</h4>
                            <p class="text-sm" style="color: var(--text-soft);">格式高い伝統的なスタイル</p>
                            <p class="text-xs mt-2">相場: 15,000-25,000円/名</p>
                        </div>
                        
                        <div class="venue-card" onclick="selectVenue('restaurant')">
                            <i class="fas fa-utensils text-3xl mb-3" style="color: var(--rose-gold);"></i>
                            <h4 class="font-bold mb-2">レストラン</h4>
                            <p class="text-sm" style="color: var(--text-soft);">美味しい料理とアットホーム</p>
                            <p class="text-xs mt-2">相場: 12,000-20,000円/名</p>
                        </div>
                        
                        <div class="venue-card" onclick="selectVenue('chapel')">
                            <i class="fas fa-church text-3xl mb-3" style="color: var(--rose-gold);"></i>
                            <h4 class="font-bold mb-2">チャペル</h4>
                            <p class="text-sm" style="color: var(--text-soft);">神聖で厳かな雰囲気</p>
                            <p class="text-xs mt-2">相場: 18,000-30,000円/名</p>
                        </div>
                        
                        <div class="venue-card" onclick="selectVenue('garden')">
                            <i class="fas fa-leaf text-3xl mb-3" style="color: var(--rose-gold);"></i>
                            <h4 class="font-bold mb-2">ガーデン</h4>
                            <p class="text-sm" style="color: var(--text-soft);">自然豊かで開放的</p>
                            <p class="text-xs mt-2">相場: 14,000-22,000円/名</p>
                        </div>
                        
                        <div class="venue-card" onclick="selectVenue('hall')">
                            <i class="fas fa-home text-3xl mb-3" style="color: var(--rose-gold);"></i>
                            <h4 class="font-bold mb-2">専門式場</h4>
                            <p class="text-sm" style="color: var(--text-soft);">結婚式のための特別な空間</p>
                            <p class="text-xs mt-2">相場: 16,000-26,000円/名</p>
                        </div>
                        
                        <div class="venue-card" onclick="selectVenue('overseas')">
                            <i class="fas fa-plane text-3xl mb-3" style="color: var(--rose-gold);"></i>
                            <h4 class="font-bold mb-2">海外</h4>
                            <p class="text-sm" style="color: var(--text-soft);">特別な思い出に</p>
                            <p class="text-xs mt-2">相場: 20,000-40,000円/名</p>
                        </div>
                    </div>
                    
                    <div class="text-center mt-8 space-x-4">
                        <button onclick="prevStep()" class="btn-primary bg-gray-300">
                            <i class="fas fa-arrow-left mr-2"></i> 前へ
                        </button>
                        <button onclick="nextStep()" class="btn-primary" id="venueNextBtn" disabled>
                            次へ <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- ステップ3: 演出・オプション -->
                <div id="section3" class="step-section hidden">
                    <h3 class="klee-font text-2xl font-bold mb-6 text-center" style="color: var(--text-dark);">
                        <i class="fas fa-magic mr-2" style="color: var(--rose-gold);"></i>
                        どんな演出をお考えですか？
                    </h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="glass-card p-4 rounded-lg">
                            <h4 class="font-bold mb-4">衣装</h4>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" class="option-check mr-3" data-cost="200000" data-category="dress">
                                    <span>ウェディングドレス（レンタル）</span>
                                    <span class="ml-auto text-sm" style="color: var(--text-soft);">20万円</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="option-check mr-3" data-cost="150000" data-category="dress">
                                    <span>カラードレス</span>
                                    <span class="ml-auto text-sm" style="color: var(--text-soft);">15万円</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="option-check mr-3" data-cost="100000" data-category="dress">
                                    <span>タキシード</span>
                                    <span class="ml-auto text-sm" style="color: var(--text-soft);">10万円</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="glass-card p-4 rounded-lg">
                            <h4 class="font-bold mb-4">写真・映像</h4>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" class="option-check mr-3" data-cost="150000" data-category="photo">
                                    <span>前撮り</span>
                                    <span class="ml-auto text-sm" style="color: var(--text-soft);">15万円</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="option-check mr-3" data-cost="200000" data-category="photo">
                                    <span>当日撮影（プロカメラマン）</span>
                                    <span class="ml-auto text-sm" style="color: var(--text-soft);">20万円</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="option-check mr-3" data-cost="180000" data-category="photo">
                                    <span>エンドロール動画</span>
                                    <span class="ml-auto text-sm" style="color: var(--text-soft);">18万円</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="glass-card p-4 rounded-lg">
                            <h4 class="font-bold mb-4">装花・装飾</h4>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" class="option-check mr-3" data-cost="150000" data-category="flower">
                                    <span>ブーケ・ブートニア</span>
                                    <span class="ml-auto text-sm" style="color: var(--text-soft);">15万円</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="option-check mr-3" data-cost="200000" data-category="flower">
                                    <span>会場装花</span>
                                    <span class="ml-auto text-sm" style="color: var(--text-soft);">20万円</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="option-check mr-3" data-cost="100000" data-category="flower">
                                    <span>テーブルコーディネート</span>
                                    <span class="ml-auto text-sm" style="color: var(--text-soft);">10万円</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="glass-card p-4 rounded-lg">
                            <h4 class="font-bold mb-4">演出</h4>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" class="option-check mr-3" data-cost="50000" data-category="performance">
                                    <span>キャンドルサービス</span>
                                    <span class="ml-auto text-sm" style="color: var(--text-soft);">5万円</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="option-check mr-3" data-cost="80000" data-category="performance">
                                    <span>バルーンリリース</span>
                                    <span class="ml-auto text-sm" style="color: var(--text-soft);">8万円</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="option-check mr-3" data-cost="120000" data-category="performance">
                                    <span>生演奏</span>
                                    <span class="ml-auto text-sm" style="color: var(--text-soft);">12万円</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-8 space-x-4">
                        <button onclick="prevStep()" class="btn-primary bg-gray-300">
                            <i class="fas fa-arrow-left mr-2"></i> 前へ
                        </button>
                        <button onclick="nextStep()" class="btn-primary">
                            次へ <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- ステップ4: 予算設定 -->
                <div id="section4" class="step-section hidden">
                    <h3 class="klee-font text-2xl font-bold mb-6 text-center" style="color: var(--text-dark);">
                        <i class="fas fa-yen-sign mr-2" style="color: var(--rose-gold);"></i>
                        ご予算はどれくらいをお考えですか？
                    </h3>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2" style="color: var(--text-dark);">
                            ご予算（総額）
                        </label>
                        <input type="range" id="budgetRange" min="1000000" max="5000000" step="100000" value="3000000" 
                               class="w-full h-2 bg-pink-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-sm mt-2" style="color: var(--text-soft);">
                            <span>100万円</span>
                            <span id="budgetDisplay" class="font-bold">300万円</span>
                            <span>500万円</span>
                        </div>
                    </div>
                    
                    <div class="glass-card p-6 rounded-lg mb-6">
                        <h4 class="font-bold mb-4 text-center">一般的な予算の目安</h4>
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div class="p-3 rounded-lg" style="background: var(--soft-pink);">
                                <p class="font-bold">200-250万円</p>
                                <p class="text-xs">シンプル婚</p>
                            </div>
                            <div class="p-3 rounded-lg" style="background: var(--sakura-pink);">
                                <p class="font-bold">300-350万円</p>
                                <p class="text-xs">一般的</p>
                            </div>
                            <div class="p-3 rounded-lg" style="background: var(--rose-gold); color: white;">
                                <p class="font-bold">400万円以上</p>
                                <p class="text-xs">豪華</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center space-x-4">
                        <button onclick="prevStep()" class="btn-primary bg-gray-300">
                            <i class="fas fa-arrow-left mr-2"></i> 前へ
                        </button>
                        <button onclick="calculateCost()" class="btn-primary">
                            <i class="fas fa-calculator mr-2"></i> 計算する
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 結果表示セクション -->
        <section id="results" class="mb-12 hidden">
            <div class="result-section">
                <h3 class="klee-font text-3xl font-bold mb-6 text-center" style="color: var(--text-dark);">
                    <i class="fas fa-heart mr-2" style="color: var(--rose-gold);"></i>
                    あなたの結婚式費用見積もり
                    <i class="fas fa-heart ml-2" style="color: var(--rose-gold);"></i>
                </h3>
                
                <div class="text-center mb-8">
                    <div class="text-5xl font-bold mb-2 klee-font" style="color: var(--rose-gold);" id="totalCost">
                        0円
                    </div>
                    <p class="text-lg" style="color: var(--text-soft);">
                        ※この金額はあくまで参考値です。実際の費用は会場により異なります。
                    </p>
                </div>
                
                <!-- 予算との比較 -->
                <div class="glass-card p-6 rounded-lg mb-6">
                    <h4 class="font-bold mb-4 text-center">ご予算との比較</h4>
                    <div id="budgetComparison" class="text-center">
                        <!-- 動的に生成 -->
                    </div>
                </div>
                
                <!-- 費用内訳 -->
                <div class="glass-card p-6 rounded-lg mb-6">
                    <h4 class="font-bold mb-4">
                        <i class="fas fa-list mr-2" style="color: var(--rose-gold);"></i>
                        費用内訳
                    </h4>
                    <div id="costBreakdown">
                        <!-- 動的に生成 -->
                    </div>
                </div>
                
                <!-- チャート表示 -->
                <div class="glass-card p-6 rounded-lg mb-6">
                    <h4 class="font-bold mb-4 text-center">費用の割合</h4>
                    <canvas id="costChart" width="400" height="200"></canvas>
                </div>
                
                <!-- 節約提案 -->
                <div class="glass-card p-6 rounded-lg mb-6">
                    <h4 class="font-bold mb-4">
                        <i class="fas fa-lightbulb mr-2" style="color: #48BB78;"></i>
                        節約のコツ
                    </h4>
                    <div id="savingsAdvice">
                        <!-- 動的に生成 -->
                    </div>
                </div>
                
                <!-- アクションボタン -->
                <div class="text-center space-y-4">
                    <div class="social-share">
                        <a href="#" onclick="shareTwitter()" class="social-btn twitter">
                            <i class="fab fa-twitter mr-2"></i>Twitterでシェア
                        </a>
                        <a href="#" onclick="shareFacebook()" class="social-btn facebook">
                            <i class="fab fa-facebook mr-2"></i>Facebookでシェア
                        </a>
                        <a href="#" onclick="shareLine()" class="social-btn line">
                            <i class="fab fa-line mr-2"></i>LINEでシェア
                        </a>
                    </div>
                    
                    <div class="space-x-4">
                        <button onclick="saveCalculation()" class="btn-primary">
                            <i class="fas fa-save mr-2"></i>計算結果を保存
                        </button>
                        <button onclick="showComparison()" class="btn-primary">
                            <i class="fas fa-balance-scale mr-2"></i>他のプランと比較
                        </button>
                        <button onclick="resetCalculator()" class="btn-primary bg-gray-300">
                            <i class="fas fa-redo mr-2"></i>もう一度計算
                        </button>
                    </div>
                    
                    <!-- A8 AFFILIATE -->
                    <div class="mt-8 p-6 glass-card rounded-lg">
                        <h4 class="font-bold mb-4 text-center">お得な結婚式場探し</h4>
                        <p class="text-center mb-4">計算結果を参考に、理想の会場を探してみませんか？</p>
                        <div class="grid md:grid-cols-3 gap-4">
                            <a href="#" class="block p-4 bg-pink-50 rounded-lg hover:bg-pink-100 transition-colors">
                                <div class="text-center">
                                    <i class="fas fa-search text-2xl mb-2" style="color: var(--rose-gold);"></i>
                                    <p class="font-bold">ゼクシィ</p>
                                    <p class="text-xs">豊富な会場情報</p>
                                </div>
                            </a>
                            <a href="#" class="block p-4 bg-pink-50 rounded-lg hover:bg-pink-100 transition-colors">
                                <div class="text-center">
                                    <i class="fas fa-heart text-2xl mb-2" style="color: var(--rose-gold);"></i>
                                    <p class="font-bold">ハナユメ</p>
                                    <p class="text-xs">お得な特典</p>
                                </div>
                            </a>
                            <a href="#" class="block p-4 bg-pink-50 rounded-lg hover:bg-pink-100 transition-colors">
                                <div class="text-center">
                                    <i class="fas fa-users text-2xl mb-2" style="color: var(--rose-gold);"></i>
                                    <p class="font-bold">みんなのウェディング</p>
                                    <p class="text-xs">口コミ情報</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 節約のコツセクション -->
        <section id="tips" class="mb-12">
            <div class="glass-card rounded-2xl p-8">
                <h3 class="klee-font text-3xl font-bold mb-8 text-center" style="color: var(--text-dark);">
                    <i class="fas fa-piggy-bank mr-2" style="color: var(--rose-gold);"></i>
                    賢い節約のコツ
                </h3>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="savings-tip">
                        <h4 class="font-bold mb-2">
                            <i class="fas fa-calendar mr-2" style="color: #48BB78;"></i>
                            時期を工夫する
                        </h4>
                        <p class="text-sm">オフシーズン（1-2月、7-8月）は会場費用が安くなることが多いです。</p>
                    </div>
                    
                    <div class="savings-tip">
                        <h4 class="font-bold mb-2">
                            <i class="fas fa-clock mr-2" style="color: #48BB78;"></i>
                            平日や夕方を選ぶ
                        </h4>
                        <p class="text-sm">土日祝日より平日、昼より夕方の方がお得な料金設定の会場が多いです。</p>
                    </div>
                    
                    <div class="savings-tip">
                        <h4 class="font-bold mb-2">
                            <i class="fas fa-hand-holding-heart mr-2" style="color: #48BB78;"></i>
                            手作りアイテム
                        </h4>
                        <p class="text-sm">招待状、席札、プチギフトなどは手作りすることで大幅に節約できます。</p>
                    </div>
                    
                    <div class="savings-tip">
                        <h4 class="font-bold mb-2">
                            <i class="fas fa-utensils mr-2" style="color: #48BB78;"></i>
                            料理のグレード調整
                        </h4>
                        <p class="text-sm">一番高いコースでなくても、おいしい料理は提供できます。試食で確認を。</p>
                    </div>
                    
                    <div class="savings-tip">
                        <h4 class="font-bold mb-2">
                            <i class="fas fa-camera mr-2" style="color: #48BB78;"></i>
                            写真撮影の工夫
                        </h4>
                        <p class="text-sm">カメラマンは最低限にして、ゲストにも写真をお願いする方法もあります。</p>
                    </div>
                    
                    <div class="savings-tip">
                        <h4 class="font-bold mb-2">
                            <i class="fas fa-gift mr-2" style="color: #48BB78;"></i>
                            引き出物を見直す
                        </h4>
                        <p class="text-sm">カタログギフトや実用的なものを選ぶことで、ゲストにも喜ばれて節約にも。</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 計算履歴セクション -->
        <section id="history" class="mb-12 hidden">
            <div class="glass-card rounded-2xl p-8">
                <h3 class="klee-font text-2xl font-bold mb-6" style="color: var(--text-dark);">
                    <i class="fas fa-history mr-2" style="color: var(--rose-gold);"></i>
                    計算履歴
                </h3>
                <div id="historyList">
                    <!-- 動的に生成 -->
                </div>
            </div>
        </section>
    </main>

    <!-- モーダル -->
    <div id="comparisonModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="klee-font text-xl font-bold">プラン比較</h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="comparisonContent">
                <!-- 動的に生成 -->
            </div>
        </div>
    </div>

    <!-- フッター -->
    <footer class="glass-card mx-4 mb-4 rounded-xl p-6">
        <div class="text-center">
            <div class="flex justify-center space-x-6 mb-4">
                <a href="#privacy" onclick="showPrivacyPolicy()" class="text-gray-600 hover:text-pink-400 transition-colors">プライバシーポリシー</a>
                <a href="#disclaimer" onclick="showDisclaimer()" class="text-gray-600 hover:text-pink-400 transition-colors">免責事項</a>
                <a href="#contact" onclick="showContact()" class="text-gray-600 hover:text-pink-400 transition-colors">お問い合わせ</a>
            </div>
            <p class="text-sm" style="color: var(--text-soft);">
                © 2025 結婚式費用計算機. All rights reserved.
            </p>
            <p class="text-xs mt-2" style="color: var(--text-soft);">
                このツールで計算された金額は参考値です。実際の費用は会場や時期により異なります。
            </p>
        </div>
    </footer>

    <!-- プライバシーポリシーモーダル -->
    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="klee-font text-xl font-bold">プライバシーポリシー</h3>
                <button onclick="closePrivacyModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4 text-sm">
                <section>
                    <h4 class="font-bold mb-2">個人情報の取り扱いについて</h4>
                    <p>当サイトでは、ユーザーの個人情報の保護を重要な責務と考え、以下の方針に基づいて個人情報を取り扱います。</p>
                </section>
                
                <section>
                    <h4 class="font-bold mb-2">収集する情報</h4>
                    <ul class="list-disc list-inside space-y-1">
                        <li>ゲスト数、地域、会場タイプなどの計算に必要な情報</li>
                        <li>サイトの利用状況に関する統計的情報</li>
                        <li>お問い合わせ時の連絡先情報</li>
                    </ul>
                </section>
                
                <section>
                    <h4 class="font-bold mb-2">利用目的</h4>
                    <ul class="list-disc list-inside space-y-1">
                        <li>結婚式費用の計算サービスの提供</li>
                        <li>サービス向上のための分析</li>
                        <li>お問い合わせへの対応</li>
                    </ul>
                </section>
                
                <section>
                    <h4 class="font-bold mb-2">第三者への提供</h4>
                    <p>法令に基づく場合を除き、ユーザーの同意なく第三者に個人情報を提供することはありません。</p>
                </section>
                
                <section>
                    <h4 class="font-bold mb-2">Cookieについて</h4>
                    <p>当サイトでは、サービス向上のためCookieを使用する場合があります。Cookieの使用を望まない場合は、ブラウザの設定で無効にできます。</p>
                </section>
                
                <section>
                    <h4 class="font-bold mb-2">お問い合わせ</h4>
                    <p>個人情報の取り扱いに関するお問い合わせは、お問い合わせフォームよりご連絡ください。</p>
                </section>
                
                <p class="text-xs mt-4">最終更新日: 2025年6月7日</p>
            </div>
        </div>
    </div>

    <!-- 免責事項モーダル -->
    <div id="disclaimerModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="klee-font text-xl font-bold">免責事項</h3>
                <button onclick="closeDisclaimerModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4 text-sm">
                <section>
                    <h4 class="font-bold mb-2">計算結果について</h4>
                    <p>当サイトで表示される費用は、一般的な相場に基づく参考値です。実際の費用は以下の要因により大きく異なる場合があります：</p>
                    <ul class="list-disc list-inside space-y-1 mt-2">
                        <li>会場の立地、グレード、設備</li>
                        <li>開催時期、曜日、時間帯</li>
                        <li>選択する料理、演出、オプション</li>
                        <li>地域の相場変動</li>
                        <li>為替レート（海外挙式の場合）</li>
                    </ul>
                </section>
                
                <section>
                    <h4 class="font-bold mb-2">情報の正確性</h4>
                    <p>当サイトの情報は、公開時点での一般的な情報に基づいていますが、その正確性、完全性を保証するものではありません。</p>
                </section>
                
                <section>
                    <h4 class="font-bold mb-2">利用に関する注意</h4>
                    <ul class="list-disc list-inside space-y-1">
                        <li>計算結果は必ず会場に直接確認してください</li>
                        <li>契約前には必ず詳細な見積もりを取得してください</li>
                        <li>当サイトの情報のみに基づく判断はお控えください</li>
                    </ul>
                </section>
                
                <section>
                    <h4 class="font-bold mb-2">損害の免責</h4>
                    <p>当サイトの利用により生じた直接的、間接的な損害について、運営者は一切の責任を負いません。</p>
                </section>
                
                <section>
                    <h4 class="font-bold mb-2">外部リンクについて</h4>
                    <p>当サイトからリンクされている外部サイトの内容について、運営者は責任を負いません。</p>
                </section>
                
                <section>
                    <h4 class="font-bold mb-2">サービスの変更・停止</h4>
                    <p>予告なくサービス内容の変更や停止を行う場合があります。</p>
                </section>
                
                <p class="text-xs mt-4">最終更新日: 2025年6月7日</p>
            </div>
        </div>
    </div>

    <!-- お問い合わせモーダル -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="klee-font text-xl font-bold">お問い合わせ</h3>
                <button onclick="closeContactModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="contactForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">お名前 *</label>
                    <input type="text" required class="form-input w-full" placeholder="山田花子">
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">メールアドレス *</label>
                    <input type="email" required class="form-input w-full" placeholder="example@email.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">お問い合わせ種別</label>
                    <select class="form-input w-full">
                        <option>サイトの使い方について</option>
                        <option>計算結果について</option>
                        <option>不具合の報告</option>
                        <option>その他</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">お問い合わせ内容 *</label>
                    <textarea required class="form-input w-full" rows="5" placeholder="お問い合わせ内容をご記入ください"></textarea>
                </div>
                
                <div class="text-center">
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-paper-plane mr-2"></i>送信する
                    </button>
                </div>
            </form>
            
            <div class="mt-6 pt-6 border-t">
                <p class="text-sm text-center" style="color: var(--text-soft);">
                    お返事までお時間をいただく場合があります。<br>
                    お急ぎの場合は、各会場に直接お問い合わせください。
                </p>
            </div>
        </div>
    </div>

    <script>
        // グローバル変数
        let currentStep = 1;
        let selectedVenue = '';
        let calculationData = {};
        let savedCalculations = JSON.parse(localStorage.getItem('weddingCalculations') || '[]');

        // 地域別基本料金データ
        const regionMultipliers = {
            'tokyo': 1.3,
            'osaka': 1.1,
            'kyoto': 1.2,
            'yokohama': 1.25,
            'nagoya': 1.0,
            'fukuoka': 0.9,
            'other': 0.85
        };

        // 会場別基本料金
        const venuePrices = {
            'hotel': { base: 500000, perPerson: 18000 },
            'restaurant': { base: 300000, perPerson: 15000 },
            'chapel': { base: 600000, perPerson: 22000 },
            'garden': { base: 400000, perPerson: 16000 },
            'hall': { base: 550000, perPerson: 20000 },
            'overseas': { base: 800000, perPerson: 30000 }
        };

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            setupEventListeners();
            loadCalculationHistory();
            
            // 予算スライダーのイベント
            const budgetRange = document.getElementById('budgetRange');
            const budgetDisplay = document.getElementById('budgetDisplay');
            
            budgetRange.addEventListener('input', function() {
                budgetDisplay.textContent = (parseInt(this.value) / 10000).toLocaleString() + '万円';
            });
        });

        function setupEventListeners() {
            // オプションチェックボックスのイベント
            document.querySelectorAll('.option-check').forEach(checkbox => {
                checkbox.addEventListener('change', updateRealTimeCalculation);
            });

            // 入力フィールドのイベント
            document.getElementById('guestCount').addEventListener('input', updateRealTimeCalculation);
            document.getElementById('region').addEventListener('change', updateRealTimeCalculation);

            // お問い合わせフォームの送信
            document.getElementById('contactForm').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('お問い合わせを受け付けました。ありがとうございます。');
                closeContactModal();
            });
        }

        function nextStep() {
            if (validateCurrentStep()) {
                document.getElementById(`section${currentStep}`).classList.add('hidden');
                document.getElementById(`step${currentStep}`).classList.remove('active');
                document.getElementById(`step${currentStep}`).classList.add('completed');
                
                currentStep++;
                
                document.getElementById(`section${currentStep}`).classList.remove('hidden');
                document.getElementById(`step${currentStep}`).classList.add('active');
                
                updateProgress();
                
                // ステップ3で演出が選択された場合のリアルタイム計算
                if (currentStep === 3) {
                    updateRealTimeCalculation();
                }
            }
        }

        function prevStep() {
            document.getElementById(`section${currentStep}`).classList.add('hidden');
            document.getElementById(`step${currentStep}`).classList.remove('active');
            
            currentStep--;
            
            document.getElementById(`step${currentStep}`).classList.remove('completed');
            document.getElementById(`step${currentStep}`).classList.add('active');
            document.getElementById(`section${currentStep}`).classList.remove('hidden');
            
            updateProgress();
        }

        function validateCurrentStep() {
            switch(currentStep) {
                case 1:
                    const guestCount = document.getElementById('guestCount').value;
                    const region = document.getElementById('region').value;
                    if (!guestCount || !region) {
                        alert('ゲスト数と地域を入力してください。');
                        return false;
                    }
                    if (guestCount < 1 || guestCount > 500) {
                        alert('ゲスト数は1名以上500名以下で入力してください。');
                        return false;
                    }
                    return true;
                case 2:
                    if (!selectedVenue) {
                        alert('会場タイプを選択してください。');
                        return false;
                    }
                    return true;
                default:
                    return true;
            }
        }

        function updateProgress() {
            const progress = (currentStep / 4) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function selectVenue(venueType) {
            // 前の選択をクリア
            document.querySelectorAll('.venue-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // 新しい選択を設定
            event.target.closest('.venue-card').classList.add('selected');
            selectedVenue = venueType;
            
            // 次へボタンを有効化
            document.getElementById('venueNextBtn').disabled = false;
            
            updateRealTimeCalculation();
        }

        function updateRealTimeCalculation() {
            if (currentStep >= 2 && selectedVenue) {
                const guestCount = parseInt(document.getElementById('guestCount').value) || 0;
                const region = document.getElementById('region').value;
                
                if (guestCount > 0 && region) {
                    const calculation = performCalculation();
                    // 簡易プレビューを表示する場合はここに追加
                }
            }
        }

        function calculateCost() {
            const calculation = performCalculation();
            displayResults(calculation);
            
            // 結果セクションを表示
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            
            // Google Analytics イベント
            if (typeof gtag !== 'undefined') {
                gtag('event', 'calculation_completed', {
                    'event_category': 'wedding_calculator',
                    'event_label': selectedVenue,
                    'value': calculation.total
                });
            }
        }

        function performCalculation() {
            const guestCount = parseInt(document.getElementById('guestCount').value);
            const region = document.getElementById('region').value;
            const budget = parseInt(document.getElementById('budgetRange').value);
            
            // 基本費用計算
            const venuePrice = venuePrices[selectedVenue];
            const regionMultiplier = regionMultipliers[region];
            
            const baseCost = venuePrice.base * regionMultiplier;
            const guestCost = venuePrice.perPerson * guestCount * regionMultiplier;
            
            // オプション費用計算
            let optionsCost = 0;
            const selectedOptions = [];
            
            document.querySelectorAll('.option-check:checked').forEach(option => {
                const cost = parseInt(option.dataset.cost);
                optionsCost += cost;
                selectedOptions.push({
                    name: option.parentElement.querySelector('span').textContent,
                    cost: cost,
                    category: option.dataset.category
                });
            });
            
            const total = baseCost + guestCost + optionsCost;
            
            calculationData = {
                guestCount,
                region,
                venue: selectedVenue,
                budget,
                baseCost,
                guestCost,
                optionsCost,
                total,
                selectedOptions,
                timestamp: new Date().toISOString()
            };
            
            return calculationData;
        }

        function displayResults(calculation) {
            // 総額表示
            document.getElementById('totalCost').textContent = 
                calculation.total.toLocaleString() + '円';
            
            // 予算との比較
            displayBudgetComparison(calculation);
            
            // 費用内訳
            displayCostBreakdown(calculation);
            
            // チャート表示
            displayCostChart(calculation);
            
            // 節約アドバイス
            displaySavingsAdvice(calculation);
        }

        function displayBudgetComparison(calculation) {
            const diff = calculation.budget - calculation.total;
            const comparisonDiv = document.getElementById('budgetComparison');
            
            if (diff >= 0) {
                comparisonDiv.innerHTML = `
                    <div class="text-green-600">
                        <i class="fas fa-check-circle text-2xl mb-2"></i>
                        <p class="font-bold text-lg">予算内におさまっています！</p>
                        <p class="text-sm">余裕額: ${diff.toLocaleString()}円</p>
                        <p class="text-xs mt-2">この余裕分で更なる演出やオプションも検討できますね。</p>
                    </div>
                `;
            } else {
                comparisonDiv.innerHTML = `
                    <div class="text-orange-600">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p class="font-bold text-lg">予算を${Math.abs(diff).toLocaleString()}円オーバーしています</p>
                        <p class="text-xs mt-2">下記の節約アドバイスを参考に調整してみましょう。</p>
                    </div>
                `;
            }
        }

        function displayCostBreakdown(calculation) {
            const breakdown = document.getElementById('costBreakdown');
            
            let html = `
                <div class="cost-item">
                    <div class="flex justify-between items-center">
                        <span><i class="fas fa-building mr-2"></i>会場基本料</span>
                        <span class="font-bold">${calculation.baseCost.toLocaleString()}円</span>
                    </div>
                </div>
                <div class="cost-item">
                    <div class="flex justify-between items-center">
                        <span><i class="fas fa-users mr-2"></i>ゲスト費用 (${calculation.guestCount}名)</span>
                        <span class="font-bold">${calculation.guestCost.toLocaleString()}円</span>
                    </div>
                    <div class="text-xs mt-1" style="color: var(--text-soft);">
                        @${(calculation.guestCost / calculation.guestCount).toLocaleString()}円/名
                    </div>
                </div>
            `;
            
            // オプション別に表示
            const optionsByCategory = {};
            calculation.selectedOptions.forEach(option => {
                if (!optionsByCategory[option.category]) {
                    optionsByCategory[option.category] = [];
                }
                optionsByCategory[option.category].push(option);
            });
            
            Object.keys(optionsByCategory).forEach(category => {
                const categoryTotal = optionsByCategory[category].reduce((sum, option) => sum + option.cost, 0);
                const categoryIcon = getCategoryIcon(category);
                const categoryName = getCategoryName(category);
                
                html += `
                    <div class="cost-item">
                        <div class="flex justify-between items-center">
                            <span><i class="fas fa-${categoryIcon} mr-2"></i>${categoryName}</span>
                            <span class="font-bold">${categoryTotal.toLocaleString()}円</span>
                        </div>
                        <div class="mt-2 space-y-1">
                `;
                
                optionsByCategory[category].forEach(option => {
                    html += `
                        <div class="flex justify-between text-xs" style="color: var(--text-soft);">
                            <span>・${option.name}</span>
                            <span>${option.cost.toLocaleString()}円</span>
                        </div>
                    `;
                });
                
                html += `</div></div>`;
            });
            
            breakdown.innerHTML = html;
        }

        function getCategoryIcon(category) {
            const icons = {
                'dress': 'tshirt',
                'photo': 'camera',
                'flower': 'leaf',
                'performance': 'music'
            };
            return icons[category] || 'star';
        }

        function getCategoryName(category) {
            const names = {
                'dress': '衣装',
                'photo': '写真・映像',
                'flower': '装花・装飾',
                'performance': '演出'
            };
            return names[category] || 'その他';
        }

        function displayCostChart(calculation) {
            const ctx = document.getElementById('costChart').getContext('2d');
            
            const data = {
                labels: ['会場基本料', 'ゲスト費用', 'オプション'],
                datasets: [{
                    data: [calculation.baseCost, calculation.guestCost, calculation.optionsCost],
                    backgroundColor: [
                        'rgba(248, 232, 232, 0.8)',
                        'rgba(232, 180, 184, 0.8)',
                        'rgba(255, 228, 230, 0.8)'
                    ],
                    borderColor: [
                        'rgba(248, 232, 232, 1)',
                        'rgba(232, 180, 184, 1)',
                        'rgba(255, 228, 230, 1)'
                    ],
                    borderWidth: 2
                }]
            };
            
            new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    family: 'Klee One, Noto Sans JP'
                                }
                            }
                        }
                    }
                }
            });
        }

        function displaySavingsAdvice(calculation) {
            const adviceDiv = document.getElementById('savingsAdvice');
            let advice = [];
            
            // 予算オーバーの場合の具体的なアドバイス
            if (calculation.total > calculation.budget) {
                const overAmount = calculation.total - calculation.budget;
                advice.push(`予算を${overAmount.toLocaleString()}円オーバーしています。以下の方法で調整してみましょう：`);
            }
            
            // 費用の割合に応じたアドバイス
            const optionRatio = calculation.optionsCost / calculation.total;
            if (optionRatio > 0.3) {
                advice.push('オプション費用が全体の30%を超えています。本当に必要なものか見直してみましょう。');
            }
            
            const guestPerPersonCost = calculation.guestCost / calculation.guestCount;
            if (guestPerPersonCost > 20000) {
                advice.push('1名あたりの費用が高めです。料理のグレードや会場タイプの見直しを検討してみてください。');
            }
            
            // 一般的な節約アドバイス
            advice.push(...[
                '平日や夕方の時間帯を選ぶと、会場費用が安くなることがあります。',
                '招待状や席札などの小物は手作りにすると大幅に節約できます。',
                '写真はカメラマンを最低限にして、ゲストにもお願いする方法があります。',
                '装花は季節の花を選ぶとコストを抑えられます。',
                '引き出物はカタログギフトにすると喜ばれて節約にもなります。'
            ]);
            
            let html = '';
            advice.forEach((tip, index) => {
                html += `
                    <div class="savings-tip">
                        <p class="text-sm">${tip}</p>
                    </div>
                `;
            });
            
            adviceDiv.innerHTML = html;
        }

        function saveCalculation() {
            const savedData = {
                ...calculationData,
                id: Date.now(),
                name: `${getVenueName(selectedVenue)}での結婚式 (${calculationData.guestCount}名)`
            };
            
            savedCalculations.unshift(savedData);
            
            // 最大10件まで保存
            if (savedCalculations.length > 10) {
                savedCalculations = savedCalculations.slice(0, 10);
            }
            
            localStorage.setItem('weddingCalculations', JSON.stringify(savedCalculations));
            
            alert('計算結果を保存しました！');
            
            loadCalculationHistory();
        }

        function loadCalculationHistory() {
            const historyList = document.getElementById('historyList');
            const historySection = document.getElementById('history');
            
            if (savedCalculations.length > 0) {
                historySection.classList.remove('hidden');
                
                let html = '';
                savedCalculations.forEach(calc => {
                    html += `
                        <div class="glass-card p-4 rounded-lg mb-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-bold">${calc.name}</h4>
                                    <p class="text-sm" style="color: var(--text-soft);">
                                        ${new Date(calc.timestamp).toLocaleDateString('ja-JP')}
                                    </p>
                                    <p class="text-lg font-bold" style="color: var(--rose-gold);">
                                        ${calc.total.toLocaleString()}円
                                    </p>
                                </div>
                                <div class="space-x-2">
                                    <button onclick="loadCalculation(${calc.id})" class="btn-primary text-xs">
                                        読み込み
                                    </button>
                                    <button onclick="deleteCalculation(${calc.id})" class="btn-primary bg-red-300 text-xs">
                                        削除
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                historyList.innerHTML = html;
            }
        }

        function loadCalculation(id) {
            const calc = savedCalculations.find(c => c.id === id);
            if (calc) {
                // フォームに値を設定
                document.getElementById('guestCount').value = calc.guestCount;
                document.getElementById('region').value = calc.region;
                document.getElementById('budgetRange').value = calc.budget;
                document.getElementById('budgetDisplay').textContent = (calc.budget / 10000).toLocaleString() + '万円';
                
                selectedVenue = calc.venue;
                calculationData = calc;
                
                // 結果を表示
                displayResults(calc);
                document.getElementById('results').classList.remove('hidden');
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function deleteCalculation(id) {
            if (confirm('この計算結果を削除しますか？')) {
                savedCalculations = savedCalculations.filter(c => c.id !== id);
                localStorage.setItem('weddingCalculations', JSON.stringify(savedCalculations));
                loadCalculationHistory();
            }
        }

        function showComparison() {
            if (savedCalculations.length < 2) {
                alert('比較するには、複数の計算結果を保存してください。');
                return;
            }
            
            const modal = document.getElementById('comparisonModal');
            const content = document.getElementById('comparisonContent');
            
            let html = '<div class="grid md:grid-cols-2 gap-4">';
            
            savedCalculations.slice(0, 4).forEach(calc => {
                html += `
                    <div class="glass-card p-4 rounded-lg">
                        <h4 class="font-bold mb-2">${calc.name}</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>ゲスト数:</span>
                                <span>${calc.guestCount}名</span>
                            </div>
                            <div class="flex justify-between">
                                <span>会場:</span>
                                <span>${getVenueName(calc.venue)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>地域:</span>
                                <span>${getRegionName(calc.region)}</span>
                            </div>
                            <div class="flex justify-between font-bold" style="color: var(--rose-gold);">
                                <span>総費用:</span>
                                <span>${calc.total.toLocaleString()}円</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
            modal.style.display = 'block';
        }

        function getVenueName(venue) {
            const names = {
                'hotel': 'ホテル',
                'restaurant': 'レストラン',
                'chapel': 'チャペル',
                'garden': 'ガーデン',
                'hall': '専門式場',
                'overseas': '海外'
            };
            return names[venue] || venue;
        }

        function getRegionName(region) {
            const names = {
                'tokyo': '東京都',
                'osaka': '大阪府',
                'kyoto': '京都府',
                'yokohama': '神奈川県',
                'nagoya': '愛知県',
                'fukuoka': '福岡県',
                'other': 'その他'
            };
            return names[region] || region;
        }

        function resetCalculator() {
            if (confirm('入力内容をリセットしますか？')) {
                // フォームリセット
                document.getElementById('guestCount').value = '';
                document.getElementById('region').value = '';
                document.getElementById('budgetRange').value = '3000000';
                document.getElementById('budgetDisplay').textContent = '300万円';
                
                // チェックボックスリセット
                document.querySelectorAll('.option-check').forEach(cb => cb.checked = false);
                
                // 会場選択リセット
                document.querySelectorAll('.venue-card').forEach(card => card.classList.remove('selected'));
                selectedVenue = '';
                
                // ステップリセット
                document.querySelectorAll('.step-section').forEach(section => section.classList.add('hidden'));
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('active', 'completed');
                });
                
                currentStep = 1;
                document.getElementById('section1').classList.remove('hidden');
                document.getElementById('step1').classList.add('active');
                document.getElementById('results').classList.add('hidden');
                
                updateProgress();
                
                // 先頭にスクロール
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // SNSシェア機能
        function shareTwitter() {
            const text = `結婚式費用計算機で見積もりしました！\n総費用: ${calculationData.total.toLocaleString()}円\n会場: ${getVenueName(selectedVenue)}\nゲスト: ${calculationData.guestCount}名\n\n#継続は力なり #結婚式 #ブライダル #費用計算`;
            const url = window.location.href;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
        }

        function shareFacebook() {
            const url = window.location.href;
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
        }

        function shareLine() {
            const text = `結婚式費用計算機で見積もり: ${calculationData.total.toLocaleString()}円`;
            const url = window.location.href;
            window.open(`https://line.me/R/msg/text/?${encodeURIComponent(text + ' ' + url)}`, '_blank');
        }

        // モーダル関連
        function closeModal() {
            document.getElementById('comparisonModal').style.display = 'none';
        }

        function showPrivacyPolicy() {
            document.getElementById('privacyModal').style.display = 'block';
        }

        function closePrivacyModal() {
            document.getElementById('privacyModal').style.display = 'none';
        }

        function showDisclaimer() {
            document.getElementById('disclaimerModal').style.display = 'block';
        }

        function closeDisclaimerModal() {
            document.getElementById('disclaimerModal').style.display = 'none';
        }

        function showContact() {
            document.getElementById('contactModal').style.display = 'block';
        }

        function closeContactModal() {
            document.getElementById('contactModal').style.display = 'none';
        }

        // モーダル外クリックで閉じる
        window.onclick = function(event) {
            const modals = ['comparisonModal', 'privacyModal', 'disclaimerModal', 'contactModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // PWA関連
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(function(err) {
                        console.error('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>

    <!-- Manifest.json内容 -->
    <script type="application/json" id="manifest-data">
    {
        "name": "結婚式費用計算機",
        "short_name": "結婚式計算機",
        "description": "理想の結婚式の費用を簡単に計算できるアプリ",
        "start_url": "/",
        "display": "standalone",
        "background_color": "#FFF8DC",
        "theme_color": "#F8E8E8",
        "icons": [
            {
                "src": "/icon-192.png",
                "sizes": "192x192",
                "type": "image/png"
            },
            {
                "src": "/icon-512.png",
                "sizes": "512x512",
                "type": "image/png"
            }
        ]
    }
    </script>
</body>
</html>
